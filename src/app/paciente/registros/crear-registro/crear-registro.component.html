<form [formGroup]="form" class="panel__main" (ngSubmit)="createRegistro()">
  <section class="panel__inner--main">
    <header class="panel__header--row">
        <app-label
        size="lg"
        [label]="registroId ? setTitle() : 'Nuevo registro de Salud'"
        [prefix]="'Autoregistro'"
        subtitle="Completa los campos requeridos (*)"
        [severity]="'info'"
        direction="row"
      ></app-label>
      <app-badge severity="success" label="Registro guardado" size="md"></app-badge>
    </header>

    <div class="form__input-wrapper--col">
      <label for="titulo">Titulo</label>
      <input type="text" formControlName="titulo" (keyup)="onTitleChange()">
    </div>

    @if (!qrResultString) {
    <div class="form__input-wrapper--col">
      <label for="descripcion"
        >Description (optional)</label>
        <textarea
          rows="5"
          type="text"
          id="descripcion"
          class=""
          placeholder="Your description goes here"
          formControlName="descripcion"
        ></textarea>
      </div>
    }

    @if (qrResultString) {
      <div class="form__input-wrapper--col">
        <label for="paciente">Registro de esta consulta</label>
        <textarea 
          id="paciente"
          formControlName="paciente">
          {{ qrResultString }}
        </textarea>
        <button (click)="clearResult()">&times;</button>
      </div>
      }

      <div class="form__input-wrapper--col">
        <label for="categoria">Categoría</label>
          <select id="categoria" formControlName="categoria" (change)="onCategoryChange()">
          <option value="" disabled selected>Select a category</option>
          @for (categoria of categorias; track categoria) {
            <option [value]="categoria">
              {{ categoria }}
            </option>
          }
        </select>
      </div>
      <div class="form__input-wrapper--col">
        <label for="adjuntos">Adjuntar archivo</label>
        <input type="file" id="adjuntos" formControlName="adjuntos" (change)="uploadFile($event)">
      </div>
    </section>

    @if (!qrRegister) {
      <section class="panel__inner--aside">
        <div class="form__input-wrapper--col">
          <label for="fecha">Fecha</label>
          <input type="date" formControlName="fecha">
        </div>
        <div class="form__input-wrapper--col">
          <label for="hora">Hora</label>
          <input type="time" formControlName="hora">
        </div>
          <app-switcher
              [on]="validado"
              size="md"
              onLabel="Validado"
              offLabel="No validado"
              labelPosition="right"
              (toggle)="validateRecord()"
          ></app-switcher>
          @if (validado) {
            <div class="form__input-wrapper--col">
              <label for="emisor">Institución/Profesional</label>
              <input type="text" formControlName="emisor">
            </div>
          }
          <!-- Integración QR con portal-profesional -->
          <img class="panel__qr--aside" src="" alt="">
          <app-label
              [size]="'sm'"
              [prefix]="'Para escanear el código, accede a tu cuenta experienciaPaciente.org.'"
              [direction]="'row'"
              [severity]="'neutral'"
              [icon]="'info-circle'"
          >
          </app-label>
      </section>
    }

    @if (qrRegister) {
      <section class="panel__inner--aside">
        <app-scan></app-scan>
      </section>
    }
       <!-- Desacoplar footer en componente -->
    <footer class="panel__footer">
      <div class="panel__footer--right">
        <app-button
        size="xs"
        [severity]="'danger'"
        [variant]="'link'"
        [icon]="'pencil'"
        [direction]="'row'"
        [label]="registroId ? 'Cancelar' : 'Reset'"
        [type]="registroId ? 'button' : 'reset'"
        (clickEvent)="cancel()"
        ></app-button>
        
        <app-button
        size="xs"
        [severity]="'primary'"
        [variant]="'link'"
        [icon]="'code'"
        [direction]="'row'"
        [label]="'Registrar desde un QR'"
        (clickEvent)="showQrRegister()"
        ></app-button>
      </div>
      <div class="panel__footer--left">
        <app-button
        [severity]="'success'"
        type="submit"
        [variant]="'fill'"
        [label]="'registroId' ? 'Registrar' : 'Confirmar'"
        [direction]="'row'"
        [icon]="'registroId' ? 'pencil' : 'check'"
        size="xs"
      >
      </app-button>
      </div>
  </footer>
</form>
